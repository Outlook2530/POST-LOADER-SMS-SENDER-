<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>MASTER AXSHU PANEL</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <style>
      body { background-color: #212529; color: #e0e0e0; }
      .container { max-width: 95%; }
      .card { background-color: #1e1e1e; border: 1px solid #333; }
      .card-title { color: #00bcd4; }
      .nav-tabs .nav-link { background-color: #1e1e1e; color: #e0e0e0; border-color: #333; }
      .nav-tabs .nav-link.active { background-color: #2c2c2c; color: #fff; border-bottom-color: #2c2c2c; }
      .table { color: #e0e0e0; }
      .table-striped > tbody > tr:nth-of-type(odd) { background-color: #1e1e1e; }
      .table-bordered { border-color: #333; }
      .table thead th { border-bottom: 2px solid #00bcd4; }
      .bg-black-custom { background-color: #000; }
      .btn-success { background-color: #28a745; border-color: #28a745; }
      .btn-warning { background-color: #ffc107; color: #000; border-color: #ffc107; }
      .btn-danger { background-color: #dc3545; border-color: #dc3545; }
      .btn-info { background-color: #17a2b8; border-color: #17a2b8; }
      pre { white-space: pre-wrap; word-wrap: break-word; }
      .badge-message { background-color: #17a2b8; }
      .badge-comment { background-color: #6f42c1; }
  </style>
</head>
<body class="bg-dark text-white">
  <div class="container py-5">
    <h2 class="text-center text-info mb-4">D3V3L0P3D BY AXSHU</h2>
    
    <div class="row text-center mb-4">
        <div class="col-md-3 mb-3">
            <div class="card">
                <div class="card-body">
                    <i class="fas fa-paper-plane fa-2x text-info mb-2"></i>
                    <h5 class="card-title">Total Messages Sent</h5>
                    <p class="card-text fs-3">{{ total_messages_sent }}</p>
                </div>
            </div>
        </div>
        <div class="col-md-3 mb-3">
            <div class="card">
                <div class="card-body">
                    <i class="fas fa-tasks fa-2x text-warning mb-2"></i>
                    <h5 class="card-title">Active Threads</h5>
                    <p class="card-text fs-3">{{ active_threads }}</p>
                </div>
            </div>
        </div>
        <div class="col-md-3 mb-3">
            <div class="card">
                <div class="card-body">
                    <i class="fas fa-comments fa-2x text-purple mb-2"></i>
                    <h5 class="card-title">Total Tasks</h5>
                    <p class="card-text fs-3">{{ tasks|length }}</p>
                </div>
            </div>
        </div>
        <div class="col-md-3 mb-3">
            <div class="card">
                <div class="card-body">
                    <i class="fas fa-heartbeat fa-2x text-success mb-2"></i>
                    <h5 class="card-title">Panel Status</h5>
                    <p class="card-text fs-3">Running</p>
                </div>
            </div>
        </div>
    </div>

    <ul class="nav nav-tabs mb-3" id="myTab" role="tablist">
      <li class="nav-item"><button class="nav-link active" data-bs-toggle="tab" data-bs-target="#sessions">üìÇ Active Sessions</button></li>
      <li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#logs">üìú Live Logs</button></li>
    </ul>

    <div class="tab-content">
      <div class="tab-pane fade show active" id="sessions">
        <div class="table-responsive">
          <table class="table table-dark table-striped table-bordered align-middle text-center">
            <thead class="table-light text-dark">
              <tr>
                <th>ID</th>
                <th>Type</th>
                <th>Status</th>
                <th>Target ID</th>
                <th>Prefix</th>
                <th>Interval</th>
                <th>Tokens</th>
                <th>Sent</th>
                <th>Start Time</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              {% for task in tasks %}
              <tr>
                <td class="small">{{ task.id[:8] }}...</td>
                <td>
                  {% if task.task_type == 'message' %}
                    <span class="badge badge-message">Message</span>
                  {% else %}
                    <span class="badge badge-comment">Comment</span>
                  {% endif %}
                </td>
                <td>
                    {% if task.status == 'Running' %}
                        <span class="badge bg-success">Running</span>
                    {% elif task.status == 'Paused' %}
                        <span class="badge bg-warning">Paused</span>
                    {% else %}
                        <span class="badge bg-danger">Stopped</span>
                    {% endif %}
                </td>
                <td class="small">{{ task.thread_id[:15] }}{% if task.thread_id|length > 15 %}...{% endif %}</td>
                <td>{{ task.prefix[:10] }}{% if task.prefix|length > 10 %}...{% endif %}</td>
                <td>{{ task.interval }}s</td>
                <td>{{ (task.tokens|fromjson)|length }}</td>
                <td>{{ task.messages_sent }}</td>
                <td class="small">{{ task.start_time.strftime('%H:%M %d/%m') }}</td>
                <td>
                    {% if task.status == 'Running' %}
                    <form method="POST" action="/pause_task/{{ task.id }}" class="d-inline">
                        <button type="submit" class="btn btn-sm btn-warning" title="Pause Task">‚è∏Ô∏è</button>
                    </form>
                    <form method="POST" action="/stop_task" class="d-inline">
                        <input type="hidden" name="taskId" value="{{ task.id }}">
                        <button type="submit" class="btn btn-sm btn-danger" title="Stop Task">‚ùå</button>
                    </form>
                    {% elif task.status == 'Paused' %}
                    <form method="POST" action="/resume_task/{{ task.id }}" class="d-inline">
                        <button type="submit" class="btn btn-sm btn-success" title="Resume Task">‚ñ∂Ô∏è</button>
                    </form>
                    <form method="POST" action="/stop_task" class="d-inline">
                        <input type="hidden" name="taskId" value="{{ task.id }}">
                        <button type="submit" class="btn btn-sm btn-danger" title="Stop Task">‚ùå</button>
                    </form>
                    {% else %}
                    <form method="POST" action="/stop_task" class="d-inline">
                        <input type="hidden" name="taskId" value="{{ task.id }}">
                        <button type="submit" class="btn btn-sm btn-danger" title="Remove Task">üóëÔ∏è</button>
                    </form>
                    {% endif %}
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>

      <div class="tab-pane fade" id="logs">
        <div class="bg-black-custom p-3 rounded" style="height:400px; overflow-y:scroll;">
          <pre id="log-box" class="text-success"></pre>
        </div>
        <div class="mt-2">
          <button class="btn btn-sm btn-info" onclick="clearLogs()">Clear Logs</button>
          <button class="btn btn-sm btn-secondary" onclick="refreshLogs()">Refresh Logs</button>
        </div>
      </div>
    </div>
    
    <div class="text-center mt-3">
      <a href="/" class="btn btn-info me-2">üè† Home</a>
      <a href="/admin/logout" class="btn btn-warning">üîí Logout</a>
    </div>
  </div>

  <script>
    // Function to fetch and display logs
    function fetchLogs() {
      fetch('/admin/logs')
        .then(res => res.text())
        .then(data => { 
          document.getElementById('log-box').innerText = data; 
          // Auto-scroll to bottom
          const logBox = document.getElementById('log-box');
          logBox.scrollTop = logBox.scrollHeight;
        })
        .catch(err => console.error('Error fetching logs:', err));
    }
    
    // Function to clear logs visually
    function clearLogs() {
      document.getElementById('log-box').innerText = 'Logs cleared...\n';
    }
    
    // Function to manually refresh logs
    function refreshLogs() {
      fetchLogs();
    }
    
    // Fetch logs initially and set interval
    fetchLogs();
    setInterval(fetchLogs, 3000);
  </script>
</body>
                  </html>
